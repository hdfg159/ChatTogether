<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'MicroWord List - '+${username}">MicroWord List</title>
    <th:block th:replace="template::editorAsset">
    </th:block>
    <script th:inline="javascript">
        function agreeMicroWord(microWordId) {
            var microWordAgreeCountSelector = $('#microWordId_agree_' + microWordId);
            $.post('[(@{/microwordagree/api/save})]', {
                'microWordId': microWordId, _csrf: [[${_csrf.token}]]
            }, function () {
            }).done(function (data, textStatus, jqXHR) {
                microWordAgreeCountSelector.val(parseInt(microWordAgreeCountSelector.val()) + 1);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.info('Request Error!' + errorThrown);
                alert('您已经点赞过!不能再操作哦~');
            });
        }
    </script>
</head>
<body>
<div th:replace="template::header"></div>
<h3 th:text="|${username}'s Microword List|"></h3>
<div th:each="microWord:${microWordList}" style="border: dashed">
    <img src=""
         th:src="@{/{profilePhoto}(profilePhoto=${microWord.user.userProfile.profilePhoto})}"
         th:width="32px"
         th:height="32px"/>
    <a th:text="${microWord.user.username}"
       th:href="@{/userprofile/details/{username}(username=${microWord.user.username})}"></a>
    <span th:text="${#dates.format(microWord.createTime,'yy-MM-dd HH:mm:ss')}"></span>
    <a href="#"
       th:href="@{/microword/details/{microWordId}(microWordId=${microWord.id})}"
       th:text="'View'">View</a>
    <p class="convert-emoji" th:utext="${microWord.content}"></p>
    <a th:each="microWordAttachment:${microWord.microWordAttachments}"
       th:href="@{/{pictureUrl}(pictureUrl=${microWordAttachment.url})}">
        <img src=""
             width="128px"
             height="128px"
             th:src="@{/{pictureUrl}(pictureUrl=${microWordAttachment.url})}"/>
    </a>
    <br/>
    <span th:text="|Comment:${#lists.size(microWord.microWordComments)}|"></span>
    <span th:text="' | Agree:'"></span>
    <input type="button" th:id="|microWordId_agree_${microWord.id}|"
           th:onclick="|agreeMicroWord(${microWord.id})|"
           th:value="${#lists.size(microWord.microWordAgrees)}"/>
</div>
<div>
    <form th:action="@{/microword/{username}(username=${username})}"
          th:method="get"
          th:onsubmit="'return pageFormSubmit()'">
        <span th:text="|${microWordList.number+1}/${microWordList.totalPages} Pages|">总页数</span>
        <input type="number" th:min="1" th:max="${microWordList.totalPages}" th:id="input_page"
               th:required="required"/>
        <input type="hidden" th:name="page" th:id="submit_page"/>
        <input type="submit" th:value="Go">
    </form>
    <a th:unless="${microWordList.number==0}"
       th:href="@{/microword/{username}(username=${username},page=${microWordList.number - 1})}"
       th:text="'Previous'">上一页</a>
    <a th:unless="${microWordList.number+1==microWordList.totalPages||microWordList.totalElements==0}"
       th:href="@{/microword/{username}(username=${username},page=${microWordList.number+1})}"
       th:text="'Next'">下一页</a>
    <span th:text="|${microWordList.numberOfElements}/${microWordList.totalElements} Elements Count|">总数据量</span>
</div>
<div th:replace="template::footer"></div>
</body>
</html>