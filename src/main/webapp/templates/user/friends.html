<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="UTF-8">
    <title>User Friend</title>
    <th:block th:replace="template::generalAsset">
    </th:block>
    <script th:inline="javascript">
        function deleteUserFriend(username) {
            $.getJSON('[(@{/userfriend/api/delete})]', {
                'username': username
            }, function () {
            }).done(function (data, textStatus, jqXHR) {
                history.go(0);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                alert('Request Error!' + errorThrown);
            });
        }
    </script>
</head>
<body>
<div th:replace="template::header"></div>
<th:block th:unless="${userFriendPage == null}">
    <table>
        <tr>
            <th>UserId</th>
            <th>UserName</th>
        </tr>
        <tr th:each="userFriend:${userFriendPage}">
            <td th:text="${userFriend.passiveUser.id}">id</td>
            <td>
                <img th:src="@{/{profilePhoto}(profilePhoto=${userFriend.passiveUser.userProfile.profilePhoto})}"
                     th:width="32px" th:height="32px"/>
                <a href="#"
                   th:href=" @{/userprofile/details/{username}(username=${userFriend.passiveUser.username})}"
                   th:text="${userFriend.passiveUser.username}"></a>
            </td>
            <td>
                <a href="#" th:href="@{/message/chat/{username}(username=${userFriend.passiveUser.username})}">Chat</a>
            </td>
            <td>
                <input th:type="button" th:value="'Delete'"
                       th:onclick="|deleteUserFriend('${userFriend.passiveUser.username}')|"/>
            </td>
        </tr>
    </table>
</th:block>
<div th:with="queryStringWithoutPage=${#strings.substringBefore(#httpServletRequest.queryString,'&page')},queryString=${#httpServletRequest.queryString}">
    <form action="" th:action="@{/userfriend/friends}" th:method="get" th:onsubmit="'return pageFormSubmit()'">
        <span th:text="|${userFriendPage.number+1}/${userFriendPage.totalPages}Pages|">总页数</span>
        <input type="number" th:min="1" th:max="${userFriendPage.totalPages}" th:id="input_page"
               th:required="required"/>
        <input type="hidden" th:name="page" th:id="submit_page"/>
        <input type="submit" th:value="Go">
    </form>
    <a th:unless="${userFriendPage.number == 0}"
       th:href="|${#httpServletRequest.requestURI}?${#strings.isEmpty(queryStringWithoutPage)?queryString:queryStringWithoutPage}&page=${userFriendPage.number - 1}|"
       th:text="'Previous'">上一页</a>
    <a th:unless="${userFriendPage.number+1==userFriendPage.totalPages||userFriendPage.totalElements==0}"
       th:href="|${#httpServletRequest.requestURI}?${#strings.isEmpty(queryStringWithoutPage)?queryString:queryStringWithoutPage}&page=${userFriendPage.number + 1}|"
       th:text="'Next'">下一页</a>
    <br/>
    <span th:text="|${userFriendPage.numberOfElements}/${userFriendPage.totalElements} Elements Count|">页面显示数据量</span>
</div>
<div th:replace="template::footer"></div>
</body>
</html>